(function(d){"use strict";d.extendext=function(){var e,t,r,i,a,l;var n=arguments[0]||{};var s=1;var o=arguments.length;var u=false;var p="default";if(typeof n==="boolean"){u=n;n=arguments[s++]||{}}if(typeof n==="string"){p=n.toLowerCase();if(p!=="concat"&&p!=="replace"&&p!=="extend"){p="default"}n=arguments[s++]||{}}if(typeof n!=="object"&&!d.isFunction(n)){n={}}if(s===o){n=this;s--}for(;s<o;s++){if((e=arguments[s])!==null){if(d.isArray(e)&&p!=="default"){l=n&&d.isArray(n)?n:[];switch(p){case"concat":n=l.concat(d.extend(u,[],e));break;case"replace":n=d.extend(u,[],e);break;case"extend":e.forEach(function(e,t){if(typeof e==="object"){var r=d.isArray(e)?[]:{};l[t]=d.extendext(u,p,l[t]||r,e)}else if(l.indexOf(e)===-1){l.push(e)}});n=l;break}}else{for(t in e){r=n[t];i=e[t];if(n===i){continue}if(u&&i&&(d.isPlainObject(i)||(a=d.isArray(i)))){if(a){a=false;l=r&&d.isArray(r)?r:[]}else{l=r&&d.isPlainObject(r)?r:{}}n[t]=d.extendext(u,p,l,i)}else if(i!==undefined){n[t]=i}}}}}return n}})(jQuery);(function(e){"use strict";var n=function(){};n.prototype={on:function(e,t){this._events=this._events||{};if(typeof e==="object"){for(var r in e){if(e.hasOwnProperty(r)){this._events[r]=this._events[r]||[];this._events[r].push(e[r])}}}else{e.split(" ").forEach(function(e){this._events[e]=this._events[e]||[];this._events[e].push(t)},this)}return this},off:function(e,r){this._events=this._events||{};if(typeof e==="object"){for(var t in e){if(e.hasOwnProperty(t)&&t in this._events){var i=this._events[t].indexOf(e[t]);if(i!==-1)this._events[t].splice(i,1)}}}else if(!!e){e.split(" ").forEach(function(e){if(e in this._events){if(r){var t=this._events[e].indexOf(r);if(t!==-1)this._events[e].splice(t,1)}else{this._events[e]=[]}}},this)}else{this._events={}}return this},once:function(e,t){this._once=this._once||{};if(typeof e==="object"){for(var r in e){if(e.hasOwnProperty(r)){this._once[r]=this._once[r]||[];this._once[r].push(e[r])}}}else{e.split(" ").forEach(function(e){this._once[e]=this._once[e]||[];this._once[e].push(t)},this)}return this},trigger:function(e){this._events=this._events||{};this._once=this._once||{};var t;var r=Array.prototype.slice.call(arguments,1);if(e in this._events){t=this._events[e].slice();while(t.length){t.shift().apply(this,r)}}if(e in this._once){t=this._once[e].slice();while(t.length){t.shift().apply(this,r)}delete this._once[e]}return this},change:function(e,t){this._events=this._events||{};if(e in this._events){var r=Array.prototype.slice.call(arguments,1);for(var i=0,a=this._events[e].length;i<a;i++){r[0]=t;t=this._events[e][i].apply(this,r)}}return t}};n.mixin=function(e,t){t=t||{};var r=["on","off","once","trigger","change"];for(var i=0,a=r.length;i<a;i++){var l=t[r[i]]||r[i];if(typeof e==="function"){e.prototype[l]=n.prototype[r[i]]}else{e[l]=n.prototype[r[i]]}}};e.MicroEvent=n})(this);(function(h){"use strict";var a=["string","integer","double","date","time","datetime","version","boolean"],e=["string","number","datetime","boolean"],l=["text","textarea","radio","checkbox","select"];var n=function(e,t){this.$el=e;this.init(t)};MicroEvent.mixin(n);n.DEFAULTS={filters:[],plugins:null,onValidationError:null,onAfterAddGroup:null,onAfterAddRule:null,display_errors:true,allow_groups:-1,allow_empty:false,conditions:["AND","OR"],default_condition:"AND",inputs_separator:" , ",default_rule_flags:{filter_readonly:false,operator_readonly:false,value_readonly:false,no_delete:false},template:{group:null,rule:null},lang:{add_rule:"Add rule",add_group:"Add group",delete_rule:"Delete",delete_group:"Delete",condition_and:"AND",condition_or:"OR",filter_select_placeholder:"------",operators:{equal:"equal",not_equal:"not equal",in:"in",not_in:"not in",less:"less than",less_or_equal:"less than or equal",greater:"greater than",greater_or_equal:"greater than or equal",between:"between",not_between:"Not between",begins_with:"begins with",not_begins_with:"doesn't begin with",contains:"contains",not_contains:"doesn't contain",ends_with:"ends with",not_ends_with:"doesn't end with",match:"match regex",not_match:"doesn't match regex",empty:"is empty",not_empty:"is not empty",null:"is null",not_null:"is not null",true:"is true",not_true:"is false"},errors:{no_filter:"No filter selected",empty_group:"The group is empty",radio_empty:"No value selected",checkbox_empty:"No value selected",select_empty:"No value selected",string_empty:"Empty value",string_exceed_min_length:"Must contain at least {0} characters",string_exceed_max_length:"Must not contain more than {0} characters",string_invalid_format:"Invalid format ({0})",number_nan:"Not a number",number_not_integer:"Not an integer",number_not_double:"Not a real number",number_exceed_min:"Must be greater than {0}",number_exceed_max:"Must be lower than {0}",number_wrong_step:"Must be a multiple of {0}",datetime_invalid:"Invalid date format ({0})",datetime_exceed_min:"Must be after {0}",datetime_exceed_max:"Must be before {0}",boolean_not_valid:"Not a boolean"}},operators:[{type:"equal",accept_values:1,multiple:false,apply_to:["string","number","datetime"]},{type:"not_equal",accept_values:1,multiple:false,apply_to:["string","number","datetime"]},{type:"in",accept_values:1,multiple:true,apply_to:["string","number","datetime"]},{type:"not_in",accept_values:1,multiple:true,apply_to:["string","number","datetime"]},{type:"less",accept_values:1,multiple:false,apply_to:["number","datetime"]},{type:"less_or_equal",accept_values:1,multiple:false,apply_to:["number","datetime"]},{type:"greater",accept_values:1,multiple:false,apply_to:["number","datetime"]},{type:"greater_or_equal",accept_values:1,multiple:false,apply_to:["number","datetime"]},{type:"between",accept_values:2,multiple:false,apply_to:["number","datetime"]},{type:"not_between",accept_values:2,multiple:false,apply_to:["number","datetime"]},{type:"begins_with",accept_values:1,multiple:false,apply_to:["string"]},{type:"not_begins_with",accept_values:1,multiple:false,apply_to:["string"]},{type:"contains",accept_values:1,multiple:false,apply_to:["string"]},{type:"not_contains",accept_values:1,multiple:false,apply_to:["string"]},{type:"ends_with",accept_values:1,multiple:false,apply_to:["string"]},{type:"not_ends_with",accept_values:1,multiple:false,apply_to:["string"]},{type:"match",accept_values:1,multiple:false,apply_to:["string"]},{type:"not_match",accept_values:1,multiple:false,apply_to:["string"]},{type:"empty",accept_values:0,multiple:false,apply_to:["string","number","datetime"]},{type:"not_empty",accept_values:0,multiple:false,apply_to:["string","number","datetime"]},{type:"null",accept_values:0,multiple:false,apply_to:["string","number","datetime"]},{type:"not_null",accept_values:0,multiple:false,apply_to:["string","number","datetime"]},{type:"true",accept_values:0,multiple:false,apply_to:["boolean"]},{type:"not_true",accept_values:0,multiple:false,apply_to:["boolean"]}],icons:{remove_rule:"icon-remove",error:"icon-warning"}};n.plugins={};n.define=function(e,t){n.plugins[e]=t};n.extend=function(e){h.extend(n.prototype,e)};n.prototype.initPlugins=function(){if(!this.settings.plugins){return}var r=this,i={};if(h.isArray(this.settings.plugins)){h.each(this.settings.plugins,function(e,t){i[t]={}})}else{h.each(this.settings.plugins,function(e,t){i[e]=t})}h.each(i,function(e,t){if(e in n.plugins){n.plugins[e].call(r,t)}else{h.error('Unable to find plugin "'+e+'"')}})};n.prototype.init=function(e){this.settings=h.extendext(true,"replace",{},n.DEFAULTS,e);this.status={group_id:0,rule_id:0,generatedId:false,has_optgroup:false};if(this.settings.allow_groups===false){this.settings.allow_groups=0}else if(this.settings.allow_groups===true){this.settings.allow_groups=-1}this.filters=this.settings.filters;this.lang=this.settings.lang;this.icons=this.settings.icons;this.operators=this.settings.operators;this.template=this.settings.template;if(this.template.group===null){this.template.group=this.getGroupTemplate}if(this.template.rule===null){this.template.rule=this.getRuleTemplate}if(!this.filters||this.filters.length<1){h.error("Missing filters list")}this.checkFilters();if(!this.$el.attr("id")){this.$el.attr("id","qb_"+Math.floor(Math.random()*99999));this.status.generatedId=true}this.$el_id=this.$el.attr("id");this.$el.addClass("query-builder");this.bindEvents();this.initPlugins();this.$el.trigger("afterInit");if(e.rules){this.setRules(e.rules)}else{this.addGroup(this.$el)}};n.prototype.destroy=function(){this.$el.trigger("beforeDestroy");if(this.status.generatedId){this.$el.removeAttr("id")}this.$el.empty().off("click.rulesBuilder change.rulesBuilder").removeClass("query-builder").removeData("rulesBuilder")};n.prototype.reset=function(){this.status.group_id=1;this.status.rule_id=0;this.$el.find(">.rules-group-container>.rules-group-body>.rules-list").empty();this.addRule(this.$el.find(">.rules-group-container"));this.$el.trigger("afterReset")};n.prototype.clear=function(){this.status.group_id=0;this.status.rule_id=0;this.$el.empty();this.$el.trigger("afterClear")};n.prototype.getRules=function(){this.clearErrors();var e=this.$el.find(">.rules-group-container"),f=this;var t=function e(t){var r={},i=t.find(">.rules-group-body>.rules-list>*");r.condition=f.getGroupCondition(t);r.rules=[];for(var a=0,l=i.length;a<l;a++){var n=i.eq(a),s;if(n.hasClass("rule-container")){var o=f.getRuleFilter(n);if(o=="-1"){f.triggerValidationError(["no_filter"],n,null,null,null);return{}}var u=f.getFilterById(o),p=f.getOperatorByType(f.getRuleOperator(n)),d=null;if(p.accept_values!==0){d=f.getRuleValue(n,u,p);var c=f.validateValue(n,d,u,p);if(c!==true){f.triggerValidationError(c,n,d,u,p);return{}}}s={id:u.id,operator:p.type,value:d};r.rules.push(s)}else{s=e(n);if(!h.isEmptyObject(s)){r.rules.push(s)}else{return{}}}}if(r.rules.length===0&&(!f.settings.allow_empty||t.data("rulesBuilder").level>1)){f.triggerValidationError(["empty_group"],t,null,null,null);return{}}return r}(e);return this.change("getRules",t)};n.prototype.setRules=function(e){this.clear();if(!e||!e.rules||e.rules.length===0&&!this.settings.allow_empty){h.error("Incorrect data object passed")}e=this.change("setRules",e);var t=this.$el,o=this;(function l(e,t){var n=o.addGroup(t,false);if(n===null){return}var r=n.find(">.rules-group-header [name$=_cond]");if(e.condition===undefined){e.condition=o.settings.default_condition}for(var i=0,a=o.settings.conditions.length;i<a;i++){var s=o.settings.conditions[i];r.filter("[value="+s+"]").prop("checked",e.condition.toUpperCase()==s.toUpperCase())}r.trigger("change");h.each(e.rules,function(e,t){if(t.rules&&t.rules.length>0){if(o.settings.allow_groups!==-1&&o.settings.allow_groups<n.data("rulesBuilder").level){o.reset();h.error(u("No more than {0} groups are allowed",o.settings.allow_groups))}else{l(t,n)}}else{if(t.id===undefined){h.error("Missing rule field id")}if(t.value===undefined){t.value=""}if(t.operator===undefined){t.operator="equal"}var r=o.addRule(n);if(r===null){return}var i=o.getFilterById(t.id),a=o.getOperatorByType(t.operator);r.find(".rule-filter-container [name$=_filter]").val(t.id).trigger("change");r.find(".rule-operator-container [name$=_operator]").val(t.operator).trigger("change");if(a.accept_values!==0){o.setRuleValue(r,t.value,i,a)}o.applyRuleFlags(r,t)}})})(e,t)};n.prototype.checkFilters=function(){var r=[],i=this;h.each(this.filters,function(e,t){if(!t.id){h.error("Missing filter id: "+e)}if(r.indexOf(t.id)!=-1){h.error("Filter already defined: "+t.id)}r.push(t.id);if(!t.type){h.error("Missing filter type: "+t.id)}if(a.indexOf(t.type)==-1){h.error("Invalid type: "+t.type)}if(!t.input){t.input="text"}else if(typeof t.input!="function"&&l.indexOf(t.input)==-1){h.error("Invalid input: "+t.input)}if(!t.field){t.field=t.id}if(!t.label){t.label=t.field}i.status.has_optgroup|=!!t.optgroup;if(!t.optgroup){t.optgroup=null}t.internalType=t.type;switch(t.type){case"version":t.internalType="string";break;case"integer":case"double":t.internalType="number";break;case"date":case"time":t.internalType="datetime";break}switch(t.input){case"radio":case"checkbox":if(!t.values||t.values.length<1){h.error("Missing values for filter: "+t.id)}break}});this.$el.trigger("afterCheckFilters")};n.prototype.bindEvents=function(){var r=this;this.$el.on("change.rulesBuilder",".rules-group-header [name$=_cond]",function(){var e=h(this);if(e.is(":checked")){e.parent().addClass("active").siblings().removeClass("active")}});this.$el.on("change.rulesBuilder",".rule-filter-container [name$=_filter]",function(){var e=h(this),t=e.closest(".rule-container");r.updateRuleFilter(t,e.val())});this.$el.on("change.rulesBuilder",".rule-operator-container [name$=_operator]",function(){var e=h(this),t=e.closest(".rule-container");r.updateRuleOperator(t,e.val())});this.$el.on("click.rulesBuilder","[data-add=rule]",function(){var e=h(this),t=e.closest(".rules-group-container");r.addRule(t)});this.$el.on("click.rulesBuilder","[data-delete=rule]",function(){var e=h(this),t=e.closest(".rule-container");r.deleteRule(t)});if(this.settings.allow_groups!==0){this.$el.on("click.rulesBuilder","[data-add=group]",function(){var e=h(this),t=e.closest(".rules-group-container");r.addGroup(t)});this.$el.on("click.rulesBuilder","[data-delete=group]",function(){var e=h(this),t=e.closest(".rules-group-container");r.deleteGroup(t)})}};n.prototype.addGroup=function(e,t){var r=this.nextGroupId(),i=((e.data("rulesBuilder")||{}).level||0)+1,a=i===1?e:e.find(">.rules-group-body>.rules-list"),l=h(this.template.group.call(this,r,i));l.data("rulesBuilder",{level:i});var n=h.Event("addGroup.rulesBuilder",{group_id:r,level:i,addRule:t,group:l,parent:e,builder:this});this.$el.trigger(n);if(n.isDefaultPrevented()){return null}a.append(l);if(this.settings.onAfterAddGroup){this.settings.onAfterAddGroup.call(this,l)}this.$el.trigger("afterAddGroup",l);if(t===undefined||t===true){this.addRule(l)}return l};n.prototype.deleteGroup=function(e){if(e[0].id==this.$el_id+"_group_0"){return}var t=h.Event("deleteGroup.rulesBuilder",{group_id:e[0].id,group:e,builder:this});this.$el.trigger(t);if(t.isDefaultPrevented()){return false}this.$el.trigger("beforeDeleteGroup",e);var r=this,i=false;e.find(">.rules-group-body>.rules-list>*").each(function(){var e=h(this);if(e.hasClass("rule-container")){if(e.data("rulesBuilder").flags.no_delete){i=true}else{e.remove()}}else{i|=!r.deleteGroup(e)}});if(!i){e.remove()}return!i};n.prototype.addRule=function(e){var t=this.nextRuleId(),r=e.find(">.rules-group-body>.rules-list"),i=h(this.template.rule.call(this,t)),a=h(this.getRuleFilterSelect(t));i.data("rulesBuilder",{flags:{}});var l=h.Event("addRule.rulesBuilder",{rule_id:t,rule:i,parent:e,builder:this});this.$el.trigger(l);if(l.isDefaultPrevented()){return null}r.append(i);i.find(".rule-filter-container").append(a);if(this.settings.onAfterAddRule){this.settings.onAfterAddRule.call(this,i)}this.$el.trigger("afterAddRule",i);return i};n.prototype.deleteRule=function(e){var t=h.Event("deleteRule.rulesBuilder",{rule_id:e[0].id,rule:e,builder:this});this.$el.trigger(t);if(t.isDefaultPrevented()){return false}this.$el.trigger("beforeDeleteRule",e);e.remove();return true};n.prototype.createRuleOperators=function(e,t){var r=e.find(".rule-operator-container").empty();if(t===null){return}var i=this.getOperators(t),a=h(this.getRuleOperatorSelect(e.attr("id"),i));r.html(a);e.data("rulesBuilder").operator=i[0];this.$el.trigger("afterCreateRuleOperators",e,t,i)};n.prototype.createRuleInput=function(e,t){var r=e.find(".rule-value-container").empty();if(t===null){return}var i=this.getOperatorByType(this.getRuleOperator(e));if(i.accept_values===0){return}var a=h();for(var l=0;l<i.accept_values;l++){var n=h(this.getRuleInput(e,t,l,i));if(l>0)r.append(this.settings.inputs_separator);r.append(n);a=a.add(n)}a.addClass("operator-"+i.type);r.show();if(t.onAfterCreateRuleInput){t.onAfterCreateRuleInput.call(this,e,t)}if(t.plugin){a[t.plugin](t.plugin_config||{})}if(t.default_value!==undefined){this.setRuleValue(e,t.default_value,t,i)}this.$el.trigger("afterCreateRuleInput",e,t,i)};n.prototype.updateRuleFilter=function(e,t){var r=t!="-1"?this.getFilterById(t):null;this.createRuleOperators(e,r);this.createRuleInput(e,r);e.data("rulesBuilder").filter=r;this.$el.trigger("afterUpdateRuleFilter",e,r)};n.prototype.updateRuleOperator=function(e,t){var r=e.find(".rule-value-container"),i=this.getFilterById(this.getRuleFilter(e)),a=this.getOperatorByType(t);if(a.accept_values===0){r.hide()}else{r.show();var l=e.data("rulesBuilder").operator;if(r.is(":empty")||a.accept_values!=l.accept_values||i.input=="select"&&a.multiple!=l.multiple){this.createRuleInput(e,i)}}e.data("rulesBuilder").operator=a;if(i.onAfterChangeOperator){i.onAfterChangeOperator.call(this,e,i,a)}this.$el.trigger("afterChangeOperator",e,i,a)};n.prototype.validateValue=function(e,t,r,i){var a=r.validation||{},l=true;if(i.accept_values==1){t=[t]}else{t=t}if(a.callback){l=a.callback.call(this,t,r,i,e);return this.change("validateValue",l,e,t,r,i)}for(var n=0;n<i.accept_values;n++){switch(r.input){case"radio":if(t[n]===undefined){l=["radio_empty"];break}break;case"checkbox":if(t[n].length===0){l=["checkbox_empty"];break}break;case"select":if(r.multiple){if(t[n].length===0){l=["select_empty"];break}}else{if(t[n]===undefined){l=["select_empty"];break}}break;default:switch(r.internalType){case"string":if(a.min!==undefined){if(t[n].length<a.min){l=["string_exceed_min_length",a.min];break}}else if(t[n].length===0){l=["string_empty"];break}if(a.max!==undefined){if(t[n].length>a.max){l=["string_exceed_max_length",a.max];break}}if(a.format){if(!a.format.test(t[n])){l=["string_invalid_format",a.format];break}}break;case"number":if(isNaN(t[n])){l=["number_nan"];break}if(r.type=="integer"){if(parseInt(t[n])!=t[n]){l=["number_not_integer"];break}}else{if(parseFloat(t[n])!=t[n]){l=["number_not_double"];break}}if(a.min!==undefined){if(t[n]<a.min){l=["number_exceed_min",a.min];break}}if(a.max!==undefined){if(t[n]>a.max){l=["number_exceed_max",a.max];break}}if(a.step!==undefined){var s=t[n]/a.step;if(parseInt(s)!=s){l=["number_wrong_step",a.step];break}}break;case"datetime":if(window.moment&&a.format){var o=moment(t[n],a.format,true);if(!o.isValid()){l=["datetime_invalid",a.format];break}else{if(a.min){if(o<moment(a.min,a.format)){l=["datetime_exceed_min",a.min];break}}if(a.max){if(o>moment(a.max,a.format)){l=["datetime_exceed_max",a.max];break}}}}break;case"boolean":if(t[n].trim().toLowerCase()!=="true"&&t[n].trim().toLowerCase()!=="false"&&t[n].trim()!=="1"&&t[n].trim()!=="0"&&t[n]!==1&&t[n]!==0){l=["boolean_not_valid"];break}}}if(l!==true){break}}return this.change("validateValue",l,e,t,r,i)};n.prototype.clearErrors=function(){this.$el.find(".has-error").removeClass("has-error")};n.prototype.triggerValidationError=function(e,t,r,i,a){if(!h.isArray(e)){e=[e]}if(i&&i.onValidationError){i.onValidationError.call(this,t,e,r,i,a)}if(this.settings.onValidationError){this.settings.onValidationError.call(this,t,e,r,i,a)}var l=h.Event("validationError.rulesBuilder",{error:e,filter:i,operator:a,value:r,targetRule:t[0],builder:this});this.$el.trigger(l);if(this.settings.display_errors&&!l.isDefaultPrevented()){var n=h.extend([],e,[this.lang.errors[e[0]]||e[0]]);t.addClass("has-error");var s=t.find(".error-container").eq(0);s.attr("title",u.apply(null,n))}this.$el.trigger("validationError",t,e)};n.prototype.nextGroupId=function(){return this.$el_id+"_group_"+this.status.group_id++};n.prototype.nextRuleId=function(){return this.$el_id+"_rule_"+this.status.rule_id++};n.prototype.getOperators=function(r){if(typeof r==="string"){r=this.getFilterById(r)}var e=[];for(var t=0,i=this.operators.length;t<i;t++){if(r.operators){if(r.operators.indexOf(this.operators[t].type)==-1){continue}}else if(this.operators[t].apply_to.indexOf(r.internalType)==-1){continue}e.push(this.operators[t])}if(r.operators){e.sort(function(e,t){return r.operators.indexOf(e.type)-r.operators.indexOf(t.type)})}return this.change("getOperators",e,r)};n.prototype.getFilterById=function(e){for(var t=0,r=this.filters.length;t<r;t++){if(this.filters[t].id==e){return this.filters[t]}}h.error("Undefined filter: "+e)};n.prototype.getOperatorByType=function(e){for(var t=0,r=this.operators.length;t<r;t++){if(this.operators[t].type==e){return this.operators[t]}}h.error("Undefined operator: "+e)};n.prototype.getGroupCondition=function(e){return e.find(">.rules-group-header [name$=_cond]:checked").val()};n.prototype.getRuleFilter=function(e){return e.find(".rule-filter-container [name$=_filter]").val()};n.prototype.getRuleOperator=function(e){return e.find(".rule-operator-container [name$=_operator]").val()};n.prototype.getRuleValue=function(e,t,r){t=t||this.getFilterById(this.getRuleFilter(e));r=r||this.getOperatorByType(this.getRuleOperator(e));var i=[],a,l=e.find(".rule-value-container");for(var n=0;n<r.accept_values;n++){var s=e[0].id+"_value_"+n;switch(t.input){case"radio":i.push(l.find("[name="+s+"]:checked").val());break;case"checkbox":a=[];l.find("[name="+s+"]:checked").each(function(){a.push(h(this).val())});i.push(a);break;case"select":if(t.multiple&&r.multiple){a=[];l.find("[name="+s+"] option:selected").each(function(){a.push(h(this).val())});i.push(a)}else{i.push(l.find("[name="+s+"] option:selected").val())}break;default:i.push(l.find("[name="+s+"]").val())}}if(r.accept_values==1){i=i[0]}if(t.valueParser){i=t.valueParser.call(this,e,i,t,r)}return this.change("getRuleValue",i,e,t,r)};n.prototype.setRuleValue=function(e,t,r,i){r=r||this.getFilterById(this.getRuleFilter(e));i=i||this.getOperatorByType(this.getRuleOperator(e));this.$el.trigger("beforeSetRuleValue",e,t,r,i);if(r.valueSetter){r.valueSetter.call(this,e,t,r,i)}else{var a=e.find(".rule-value-container");if(i.accept_values==1){t=[t]}else{t=t}for(var l=0;l<i.accept_values;l++){var n=e[0].id+"_value_"+l;switch(r.input){case"radio":a.find("[name="+n+'][value="'+t[l]+'"]').prop("checked",true).trigger("change");break;case"checkbox":if(!h.isArray(t[l])){t[l]=[t[l]]}h.each(t[l],function(e,t){a.find("[name="+n+'][value="'+t+'"]').prop("checked",true).trigger("change")});break;default:a.find("[name="+n+"]").val(t[l]).trigger("change");break}}}this.$el.trigger("afterSetRuleValue",e,t,r,i);if(r.onAfterSetValue){r.onAfterSetValue.call(this,e,t,r,i)}};n.prototype.applyRuleFlags=function(e,t){var r=this.getRuleFlags(t);e.data("rulesBuilder").flags=r;if(r.filter_readonly){e.find("[name$=_filter]").prop("disabled",true)}if(r.operator_readonly){e.find("[name$=_operator]").prop("disabled",true)}if(r.value_readonly){e.find("[name*=_value_]").prop("disabled",true)}if(r.no_delete){e.find("[data-delete=rule]").remove()}this.$el.trigger("afterApplyRuleFlags",e,t,r)};n.prototype.getGroupTemplate=function(e,t){var r='<dl id="'+e+'" class="rules-group-container level-'+t+'"> <dt class="rules-group-header"> <div class="btn-group group-actions"> <button type="button" class="btn btn-xs btn-green add_rule" data-add="rule" title="'+this.lang.add_rule+'"> '+this.lang.add_rule+"</button> "+(this.settings.allow_groups===-1||this.settings.allow_groups>=t?'<button type="button" class="btn btn-xs btn-blue add_group" data-add="group" title="'+this.lang.add_group+'"> '+this.lang.add_group+"</button>":"")+" </div>"+(t>1?'<button type="button" class="btn btn-xs btn-red delete_group float-right" data-delete="group" title="'+this.lang.delete_group+'"> '+this.lang.delete_group+"</button>":"")+' <div class="btn-group group-conditions"> '+this.getGroupConditions(e)+" </div> "+(this.settings.display_errors?'<div class="error-container" data-toggle="tooltip" data-placement="right"><i class="'+this.icons.error+'"></i></div>':"")+"</dt> <dd class=rules-group-body> <ul class=rules-list></ul> </dd> </dl>";return this.change("getGroupTemplate",r,t)};n.prototype.getGroupConditions=function(e){var t="";for(var r=0,i=this.settings.conditions.length;r<i;r++){var a=this.settings.conditions[r],l=a==this.settings.default_condition,n=this.lang["condition_"+a.toLowerCase()]||a;t+='<label class="btn btn-xs '+(l?"active":"")+'"> <input type="radio" name="'+e+'_cond" value="'+a+'" '+(l?"checked":"")+"> "+n+" </label>"}return this.change("getGroupConditions",t)};n.prototype.getRuleTemplate=function(e){var t='<li id="'+e+'" class="rule-container"> <div class="rule-header"> <div class="btn-group float-right rule-actions"> <button type="button" class="btn btn-xs btn-empty btn-red" data-delete="rule" title="'+this.lang.delete_rule+'"> <i class="'+this.icons.remove_rule+'"></i></button> </div> </div> '+(this.settings.display_errors?'<div class="error-container"><i class="'+this.icons.error+'"></i></div>':"")+'<div class="rule-filter-container"></div> <div class="rule-operator-container"></div> <div class="rule-value-container"></div> </li>';return this.change("getRuleTemplate",t)};n.prototype.getRuleFilterSelect=function(e){var r=null;var i='<select name="'+e+'_filter">';i+='<option value="-1">'+this.lang.filter_select_placeholder+"</option>";h.each(this.filters,function(e,t){if(r!=t.optgroup){if(r!==null)i+="</optgroup>";r=t.optgroup;if(r!==null)i+='<optgroup label="'+r+'">'}i+='<option value="'+t.id+'">'+t.label+"</option>"});if(r!==null)i+="</optgroup>";i+="</select>";return this.change("getRuleFilterSelect",i)};n.prototype.getRuleOperatorSelect=function(e,t){var r='<select name="'+e+'_operator">';for(var i=0,a=t.length;i<a;i++){var l=this.lang.operators[t[i].type]||t[i].type;r+='<option value="'+t[i].type+'">'+l+"</option>"}r+="</select>";return this.change("getRuleOperatorSelect",r)};n.prototype.getRuleInput=function(e,t,r,i){var a=t.validation||{},l=e[0].id+"_value_"+r,n="",s;if(typeof t.input==="function"){n=t.input.call(this,e,t,l)}else{switch(t.input){case"radio":s=t.vertical?" class=block":"";o(t.values,function(e,t){n+="<label"+s+'><input type="radio" name="'+l+'" value="'+e+'"> '+t+"</label> "});break;case"checkbox":s=t.vertical?" class=block":"";o(t.values,function(e,t){n+="<label"+s+'><input type="checkbox" name="'+l+'" value="'+e+'"> '+t+"</label> "});break;case"select":n+='<select name="'+l+'"'+(t.multiple&&i.multiple?" multiple":"")+">";o(t.values,function(e,t){n+='<option value="'+e+'"> '+t+"</option> "});n+="</select>";break;case"textarea":n+='<textarea name="'+l+'"';if(t.size)n+=' cols="'+t.size+'"';if(t.rows)n+=' rows="'+t.rows+'"';if(a.min!==undefined)n+=' minlength="'+a.min+'"';if(a.max!==undefined)n+=' maxlength="'+a.max+'"';if(t.placeholder)n+=' placeholder="'+t.placeholder+'"';n+="></textarea>";break;default:switch(t.internalType){case"number":n+='<input type="number" name="'+l+'"';if(a.step!==undefined)n+=' step="'+a.step+'"';if(a.min!==undefined)n+=' min="'+a.min+'"';if(a.max!==undefined)n+=' max="'+a.max+'"';if(t.placeholder)n+=' placeholder="'+t.placeholder+'"';if(t.size)n+=' size="'+t.size+'"';n+=">";break;default:n+='<input type="text" name="'+l+'"';if(t.placeholder)n+=' placeholder="'+t.placeholder+'"';if(t.type==="string"&&a.min!==undefined)n+=' minlength="'+a.min+'"';if(t.type==="string"&&a.max!==undefined)n+=' maxlength="'+a.max+'"';if(t.size)n+=' size="'+t.size+'"';n+=">"}}}return this.change("getRuleInput",n,e,t,l)};n.prototype.getRuleFlags=function(e){var t=h.extend({},this.settings.default_rule_flags);if(e.readonly){h.extend(t,{filter_readonly:true,operator_readonly:true,value_readonly:true,no_delete:true})}if(e.flags){h.extend(t,e.flags)}return this.change("getRuleFlags",t,e)};h.fn.rulesBuilder=function(e){if(this.length>1){h.error("Unable to initialize on multiple target")}var t=this.data("rulesBuilder"),r=typeof e=="object"&&e||{};if(!t&&e=="destroy"){return this}if(!t){this.data("rulesBuilder",new n(this,r))}if(typeof e=="string"){return t[e].apply(t,Array.prototype.slice.call(arguments,1))}return this};h.fn.rulesBuilder.defaults={set:function(e){h.extendext(true,"replace",n.DEFAULTS,e)},get:function(e){var t=n.DEFAULTS;if(e){t=t[e]}return h.extend(true,{},t)}};h.fn.rulesBuilder.constructor=n;h.fn.rulesBuilder.extend=n.extend;h.fn.rulesBuilder.define=n.define;function o(e,r){if(e){if(h.isArray(e)){h.each(e,function(e,t){if(h.isPlainObject(t)){h.each(t,function(e,t){r(e,t);return false})}else{r(e,t)}})}else{h.each(e,function(e,t){r(e,t)})}}}function u(e,r){r=Array.prototype.slice.call(arguments);return e.replace(/{([0-9]+)}/g,function(e,t){return r[parseInt(t)+1]})}})(jQuery);(function(e){var p={equal:{template:"=?"},not_equal:{template:"!=?"},in:{template:" in(?)",sep:", "},not_in:{template:" not in(?)",sep:", "},less:{template:"<?"},less_or_equal:{template:"<=?"},greater:{template:">?"},greater_or_equal:{template:">=?"},between:{template:" between(?)"},not_between:{template:" not between(?)"},begins_with:{template:" begins with ?"},not_begins_with:{template:" doesn't begin with ?"},contains:{template:" contains ?"},not_contains:{template:" doesn't contain ?"},ends_with:{template:" ends with ?"},not_ends_with:{template:" doesn't end with ?"},match:{template:" match ?"},not_match:{template:" doesn't match ?"},empty:{template:"=''"},not_empty:{template:"!=''"},null:{template:'=<span class="rlv">NULL</span>'},not_null:{template:'!=<span class="rlv">NULL</span>'},true:{template:'=<span class="rlv">TRUE</span>'},not_true:{template:'=<span class="rlv">FALSE</span>'}};function d(e){return Array.isArray(e)}function c(e){return!isNaN(parseFloat(e))}e.fn.rulesBuilder.extend({getText:function(){var u=this;var e=u.getRules();function l(e){var t=[];var r=e.id;var i=e.operator;var a=e.value;var l=u.getFilterById(r);var n=p[i];t.push('<span class="rlf">'+l.label+"</span>");if(Array.isArray(a)){var s=n.sep||" &amp; ";var o=a;o.forEach(function(e,t){if(l.values&&!d(l.values)){e=l.values[e]}if(!c(e)){e='"'+e+'"'}e='<span class="rlv">'+e+"</span>";o[t]=e});a=o.join(s)}else{if(l.values){a=l.values[a]}if(!c(a)){a='"'+a+'"'}a='<span class="rlv">'+a+"</span>"}t.push(n.template.replace("?",a));return t.join("")}function n(e){var t="";if(e&&e.condition&&e.rules){var r=[];var i=e.condition;var a=e.rules;a.forEach(function(e){if(e.id){r.push(l(e))}else{r.push('<span class="grb">{</span> '+n(e)+' <span class="grb">}</span>')}});t=r.join(' <span class="gro">'+i+"</span> ")}return t}return n(e)}})})(jQuery);